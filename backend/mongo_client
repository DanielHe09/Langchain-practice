import os
from dotenv import load_dotenv
from pymongo.mongo_client import MongoClient
from pymongo.server_api import ServerApi
from urllib.parse import quote_plus

# Load environment variables from .env file
load_dotenv()

# Use standard connection string to avoid DNS resolver issues
# URL encode credentials to handle special characters
username = quote_plus(os.getenv("MONGO_USERNAME", ""))
password = quote_plus(os.getenv("MONGO_PASSWORD", ""))

# Standard MongoDB connection string format
# Try without replicaSet first - MongoDB will auto-detect it
uri = f"mongodb+srv://{username}:{password}@langchainpractice.udlewkq.mongodb.net/?appName=langchainPractice"

# Create a new client and connect to the server
client = MongoClient(
    uri, 
    server_api=ServerApi('1'),
    tlsAllowInvalidCertificates=True,
    serverSelectionTimeoutMS=15000,
    connectTimeoutMS=10000,
    socketTimeoutMS=10000
)
# Send a ping to confirm a successful connection
try:
    client.admin.command('ping')
    print("Pinged your deployment. You successfully connected to MongoDB!")
except Exception as e:
    print(e)